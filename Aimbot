--================================
-- ESP SKELETON SYNC (RONIX)
-- REAL SIZE + REAL MOVEMENT
--================================

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

local lp = Players.LocalPlayer
local MAX_DISTANCE = 800

local esp = {}

-- pares de ossos (R15 + R6 compatÃ­vel)
local bones = {
	{"Head","UpperTorso"},
	{"UpperTorso","LowerTorso"},

	{"UpperTorso","LeftUpperArm"},
	{"LeftUpperArm","LeftLowerArm"},
	{"LeftLowerArm","LeftHand"},

	{"UpperTorso","RightUpperArm"},
	{"RightUpperArm","RightLowerArm"},
	{"RightLowerArm","RightHand"},

	{"LowerTorso","LeftUpperLeg"},
	{"LeftUpperLeg","LeftLowerLeg"},
	{"LeftLowerLeg","LeftFoot"},

	{"LowerTorso","RightUpperLeg"},
	{"RightUpperLeg","RightLowerLeg"},
	{"RightLowerLeg","RightFoot"},
}

local function newLine(parent)
	local f = Instance.new("Frame")
	f.BorderSizePixel = 0
	f.BackgroundColor3 = Color3.fromRGB(255,0,0)
	f.AnchorPoint = Vector2.new(0.5,0.5)
	f.Parent = parent
	return f
end

local function createESP(plr)
	if esp[plr] then return end

	local gui = Instance.new("BillboardGui")
	gui.Name = "SkeletonESP"
	gui.Size = UDim2.new(4,0,6,0)
	gui.AlwaysOnTop = true
	gui.MaxDistance = MAX_DISTANCE
	gui.Parent = plr.Character

	local name = Instance.new("TextLabel")
	name.BackgroundTransparency = 1
	name.Size = UDim2.new(1,0,0,16)
	name.Position = UDim2.new(0,0,-0.15,0)
	name.Text = plr.Name
	name.TextSize = 12
	name.Font = Enum.Font.GothamBold
	name.TextColor3 = Color3.fromRGB(255,80,80)
	name.TextStrokeTransparency = 0
	name.Parent = gui

	local lines = {}
	for i = 1,#bones do
		lines[i] = newLine(gui)
	end

	esp[plr] = {gui = gui, lines = lines}
end

local function removeESP(plr)
	if esp[plr] then
		esp[plr].gui:Destroy()
		esp[plr] = nil
	end
end

-- UPDATE
RunService.RenderStepped:Connect(function()
	for _,plr in ipairs(Players:GetPlayers()) do
		if plr ~= lp and plr.Character then
			local char = plr.Character
			local hrp = char:FindFirstChild("HumanoidRootPart")
			local hum = char:FindFirstChild("Humanoid")

			if hrp and hum and hum.Health > 0 then
				if not esp[plr] then
					createESP(plr)
				end

				local data = esp[plr]
				data.gui.Adornee = hrp

				for i,b in ipairs(bones) do
					local p0 = char:FindFirstChild(b[1])
					local p1 = char:FindFirstChild(b[2])
					local line = data.lines[i]

					if p0 and p1 then
						local v0, on1 = Camera:WorldToViewportPoint(p0.Position)
						local v1, on2 = Camera:WorldToViewportPoint(p1.Position)

						if on1 and on2 then
							local dx = v1.X - v0.X
							local dy = v1.Y - v0.Y
							local dist = math.sqrt(dx*dx + dy*dy)

							line.Size = UDim2.new(0, dist, 0, 2)
							line.Position = UDim2.new(0, (v0.X+v1.X)/2, 0, (v0.Y+v1.Y)/2)
							line.Rotation = math.deg(math.atan2(dy, dx))
							line.Visible = true
						else
							line.Visible = false
						end
					else
						line.Visible = false
					end
				end
			else
				removeESP(plr)
			end
		end
	end
end)

Players.PlayerRemoving:Connect(removeESP)
